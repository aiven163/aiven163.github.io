<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Aiven技术博客</title>

    <!-- 使用url函数转换相关路径 -->
    <link rel="stylesheet" href="http://mogu.io/admin/css/normalize.css">
    <link rel="stylesheet" href="http://mogu.io/admin/css/grid.css">
    <link rel="stylesheet" href="http://mogu.io/usr/themes/default/style.css">

    <!--[if lt IE 9]>
    <script src="http://mogu.io/admin/js/html5shiv.js"></script>
    <script src="http://mogu.io/admin/js/respond.js"></script>
    <![endif]-->

    <!-- 通过自有函数输出HTML头部信息 -->
    <meta name="keywords" content="Aiven,技术,分享," />
<meta name="generator" content="Typecho 1.0/14.10.10" />
<meta name="template" content="default" />
<link rel="pingback" href="http://mogu.io/action/xmlrpc" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://mogu.io/action/xmlrpc?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://mogu.io/action/xmlrpc?wlw" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://mogu.io/feed/" />
<link rel="alternate" type="application/rdf+xml" title="RSS 1.0" href="http://mogu.io/feed/rss/" />
<link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="http://mogu.io/feed/atom/" />
</head>
<body>
<!--[if lt IE 8]>
    <div class="browsehappy">当前网页 <strong>不支持</strong> 你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.</div>
<![endif]-->

<header id="header" class="clearfix">
    <div class="container">
        <div class="colgroup">
            <div class="site-name col-mb-12 col-9" style="padding-left:75px;background:url(http://s13.mogujie.cn/pic/140520/2r6z_kq2dcttekrbewq2ugfjeg5sckzsew_65x65.png) no-repeat; height: 65px; padding-top:13px;">
                <a id="logo" href="http://aiven163.github.io/">
                                        Aiven博客                </a>
                <p class="description"></p>
            </div>
            <div class="site-search col-3 kit-hidden-tb">
                <form id="search" method="post" action="./" role="search">
                    <label for="s" class="sr-only">搜索关键字</label>
                    <input type="text" name="s" class="text" placeholder="输入关键字搜索" />
                    <button type="submit" class="submit">搜索</button>
                </form>
            </div>
            <div class="col-mb-12">
                <nav id="nav-menu" class="clearfix" role="navigation">
                    <a class="current" href="http://aiven163.github.io/">首页</a>
                </nav>
            </div>
        </div><!-- end .colgroup -->
    </div>
</header><!-- end #header -->


<div id="body">
    <div class="container">
        <div class="colgroup clearfix">
            <div class="col-mb-18 col-14" id="main" role="main">


<content>
        
        <!--<h2>Android App 沉浸式状态栏解决方案</h2>-->
    	<p>伴随着 Android 5.0 发布的 Material Design，让 Android 应用告别了以前的工程师审美，迎来了全新的界面，灵动的交互，也让越来越多的 App 开始遵从 material design 设计原则，不再是以前拿着iOS设计稿，做着Android开发。本文就其中的沉浸式状态栏这一特性，描述其兼容到4.4的实现，以及一些使用中的小细节。</p>

<h3 id="section">前言</h3>
<p>在4.4之前状态栏一直是黑色的，在4.4中带来了 <code class="highlighter-rouge">windowTranslucentStatus</code> 这一特性，因此可以实现给状态栏设置颜色，如下图所示，状态栏颜色不再是黑色，而是可以定制的颜色。</p>

<p><img src="http://ac-qygvx1cc.clouddn.com/e61aeb3f3cc44354.png" alt="" /></p>

<p>国内将状态栏变色叫做沉浸式状态栏，时间久了，叫的人多了，大家就不再深究，默认了这种叫法。</p>

<p>可以在知乎上看到关于这个问题的讨论：<a href="https://www.zhihu.com/question/27040217">为什么在国内会有很多用户把「透明栏」（Translucent Bars）称作 「沉浸式顶栏」？</a></p>

<h3 id="section-1">需要解决的问题</h3>
<ol>
  <li>4.4及其以上都是可以实现沉浸式状态栏效果的，5.0及其以上可以直接在主题中设置颜色，或者调用 <code class="highlighter-rouge">Window</code> 类中的 <code class="highlighter-rouge">setStatusBarColor(int color)</code> 来实现，这两种方式在5.0上都比较简单，但是如何兼容到4.4呢？</li>
  <li>图片背景的页面,怎样让状态栏透明或者半透明（效果如下）？
<img src="http://ac-qygvx1cc.clouddn.com/74a963666851b9bd.png" alt="" /></li>
  <li>使用 DrawerLayout 时，主界面实现沉浸状态栏同时，怎样保证抽屉视图也能延伸到状态栏（如下图所示），且兼容到4.4？
<img src="http://ac-qygvx1cc.clouddn.com/9585eb130bb180b5.png" alt="" /></li>
</ol>

<p>以上就是本文要解决的问题，下面给出解决方案。</p>

<h3 id="section-2">解决方案</h3>

<h4 id="section-3">1. 给状态栏设置颜色</h4>
<p>思路是：</p>

<ul>
  <li>先设置状态栏透明属性；</li>
  <li>给根布局加上一个和状态栏一样大小的矩形View（色块），添加到顶上；</li>
  <li>然后设置根布局的 <code class="highlighter-rouge">FitsSystemWindows</code> 属性为 <code class="highlighter-rouge">true</code>,此时根布局会延伸到状态栏，处在状态栏位置的就是之前添加的色块，这样就给状态栏设置上颜色了。</li>
</ul>

<p>代码如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 设置状态栏颜色
     *
     * @param activity 需要设置的activity
     * @param color    状态栏颜色值
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">setColor</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">,</span> <span class="kt">int</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">KITKAT</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 设置状态栏透明</span>
            <span class="n">activity</span><span class="o">.</span><span class="na">getWindow</span><span class="o">().</span><span class="na">addFlags</span><span class="o">(</span><span class="n">WindowManager</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">FLAG_TRANSLUCENT_STATUS</span><span class="o">);</span>
            <span class="c1">// 生成一个状态栏大小的矩形</span>
            <span class="n">View</span> <span class="n">statusView</span> <span class="o">=</span> <span class="n">createStatusView</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="n">color</span><span class="o">);</span>
            <span class="c1">// 添加 statusView 到布局中</span>
            <span class="n">ViewGroup</span> <span class="n">decorView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewGroup</span><span class="o">)</span> <span class="n">activity</span><span class="o">.</span><span class="na">getWindow</span><span class="o">().</span><span class="na">getDecorView</span><span class="o">();</span>
            <span class="n">decorView</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">statusView</span><span class="o">);</span>
            <span class="c1">// 设置根布局的参数</span>
            <span class="n">ViewGroup</span> <span class="n">rootView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewGroup</span><span class="o">)</span> <span class="o">((</span><span class="n">ViewGroup</span><span class="o">)</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">content</span><span class="o">)).</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="n">rootView</span><span class="o">.</span><span class="na">setFitsSystemWindows</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">rootView</span><span class="o">.</span><span class="na">setClipToPadding</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>其中生成状态栏一样大小的矩形色块的代码如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 生成一个和状态栏大小相同的矩形条
     *
     * @param activity 需要设置的activity
     * @param color    状态栏颜色值
     * @return 状态栏矩形条
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">View</span> <span class="n">createStatusView</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">,</span> <span class="kt">int</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 获得状态栏高度</span>
        <span class="kt">int</span> <span class="n">resourceId</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">getResources</span><span class="o">().</span><span class="na">getIdentifier</span><span class="o">(</span><span class="s">"status_bar_height"</span><span class="o">,</span> <span class="s">"dimen"</span><span class="o">,</span> <span class="s">"android"</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">statusBarHeight</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">getResources</span><span class="o">().</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">resourceId</span><span class="o">);</span>

        <span class="c1">// 绘制一个和状态栏一样高的矩形</span>
        <span class="n">View</span> <span class="n">statusView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">View</span><span class="o">(</span><span class="n">activity</span><span class="o">);</span>
        <span class="n">LinearLayout</span><span class="o">.</span><span class="na">LayoutParams</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinearLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">(</span><span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">MATCH_PARENT</span><span class="o">,</span>
                <span class="n">statusBarHeight</span><span class="o">);</span>
        <span class="n">statusView</span><span class="o">.</span><span class="na">setLayoutParams</span><span class="o">(</span><span class="n">params</span><span class="o">);</span>
        <span class="n">statusView</span><span class="o">.</span><span class="na">setBackgroundColor</span><span class="o">(</span><span class="n">color</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">statusView</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>在 <code class="highlighter-rouge">setContentView()</code> 之后调用 <code class="highlighter-rouge">setColor(Activity activity, int color)</code> 方法即可。</p>

<h4 id="section-4">2. 图片作背景时，状态栏透明</h4>
<p>这个实现比较简单，根布局背景设置为图片，然后添加状态栏透明 Flag， 然后设置根布局的 <code class="highlighter-rouge">FitsSystemWindows</code> 属性为 <code class="highlighter-rouge">true</code> 即可。代码如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 使状态栏透明
     * &lt;p&gt;
     * 适用于图片作为背景的界面,此时需要图片填充到状态栏
     *
     * @param activity 需要设置的activity
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">setTranslucent</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">KITKAT</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 设置状态栏透明</span>
            <span class="n">activity</span><span class="o">.</span><span class="na">getWindow</span><span class="o">().</span><span class="na">addFlags</span><span class="o">(</span><span class="n">WindowManager</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">FLAG_TRANSLUCENT_STATUS</span><span class="o">);</span>
            <span class="c1">// 设置根布局的参数</span>
            <span class="n">ViewGroup</span> <span class="n">rootView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewGroup</span><span class="o">)</span> <span class="o">((</span><span class="n">ViewGroup</span><span class="o">)</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">content</span><span class="o">)).</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="n">rootView</span><span class="o">.</span><span class="na">setFitsSystemWindows</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">rootView</span><span class="o">.</span><span class="na">setClipToPadding</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>同样的，在 <code class="highlighter-rouge">setContentView()</code> 之后调用 <code class="highlighter-rouge">setTranslucent(Activity activity)</code> 方法即可。</p>

<h4 id="drawerlayout-">3. 使用 DrawerLayout 时的特殊处理</h4>

<p><strong>注意点：</strong></p>

<ul>
  <li>
    <p>使用 DrawerLayout 时，此时不能再对根布局，即 DrawerLayout 进行设置，而要针对 DrawerLayout 的内容布局进行设置，即抽屉之外的另一个布局。</p>

    <p>如下是一个典型的 DrawerLayout 的布局，其内容布局即 <code class="highlighter-rouge">FrameLayout</code>,我们需要对 <code class="highlighter-rouge">FrameLayout </code> 进行仿状态栏色块的添加、<code class="highlighter-rouge">FitsSystemWindows</code> 属性的设置。</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>

<span class="nt">&lt;android.support.v4.widget.DrawerLayout</span>
    <span class="na">android:id=</span><span class="s">"@+id/drawer_layout"</span>
    <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;FrameLayout</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;LinearLayout</span>
            <span class="na">android:id=</span><span class="s">"@+id/main"</span>
            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
            <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
            <span class="na">android:orientation=</span><span class="s">"vertical"</span><span class="nt">&gt;</span>

            <span class="nt">&lt;android.support.v7.widget.Toolbar</span>
                <span class="na">android:id=</span><span class="s">"@+id/toolbar"</span>
                <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
                <span class="na">android:layout_height=</span><span class="s">"?attr/actionBarSize"</span>
                <span class="na">android:background=</span><span class="s">"@color/colorPrimary"</span>
                <span class="na">app:popupTheme=</span><span class="s">"@style/ThemeOverlay.AppCompat.Light"</span>
                <span class="na">app:theme=</span><span class="s">"@style/ThemeOverlay.AppCompat.Dark.ActionBar"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/LinearLayout&gt;</span>
    <span class="nt">&lt;/FrameLayout&gt;</span>

    <span class="nt">&lt;android.support.design.widget.NavigationView</span>
        <span class="na">android:id=</span><span class="s">"@+id/navigation"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_gravity=</span><span class="s">"start"</span>
        <span class="na">app:headerLayout=</span><span class="s">"@layout/nav_header"</span>
        <span class="na">app:menu=</span><span class="s">"@menu/activity_main_drawer"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/android.support.v4.widget.DrawerLayout&gt;</span>
</code></pre>
</div>

<ul>
  <li>还有一个需要注意的设置抽屉布局（Drawer）的 <code class="highlighter-rouge">FitsSystemWindows</code> 属性为 <code class="highlighter-rouge">false</code>，即上面布局中的 <code class="highlighter-rouge">NavigationView</code>。</li>
</ul>

<p><strong>解决方案</strong></p>

<ul>
  <li>
    <p>DrawerLayout 状态栏变色</p>

    <p>代码如下：</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 为DrawerLayout 布局设置状态栏变色
     *
     * @param activity     需要设置的activity
     * @param drawerLayout DrawerLayout
     * @param color        状态栏颜色值
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">setColorForDrawerLayout</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">,</span> <span class="n">DrawerLayout</span> <span class="n">drawerLayout</span><span class="o">,</span> <span class="kt">int</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">KITKAT</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">activity</span><span class="o">.</span><span class="na">getWindow</span><span class="o">().</span><span class="na">addFlags</span><span class="o">(</span><span class="n">WindowManager</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">FLAG_TRANSLUCENT_STATUS</span><span class="o">);</span>
            <span class="c1">// 生成一个状态栏大小的矩形</span>
            <span class="n">View</span> <span class="n">statusBarView</span> <span class="o">=</span> <span class="n">createStatusBarView</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="n">color</span><span class="o">);</span>
            <span class="c1">// 添加 statusBarView 到布局中</span>
            <span class="n">ViewGroup</span> <span class="n">contentLayout</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewGroup</span><span class="o">)</span> <span class="n">drawerLayout</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="n">contentLayout</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">statusBarView</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="c1">// 内容布局不是 LinearLayout 时,设置padding top</span>
            <span class="k">if</span> <span class="o">(!(</span><span class="n">contentLayout</span> <span class="k">instanceof</span> <span class="n">LinearLayout</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">contentLayout</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">contentLayout</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">setPadding</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">getStatusBarHeight</span><span class="o">(</span><span class="n">activity</span><span class="o">),</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="c1">// 设置属性</span>
            <span class="n">ViewGroup</span> <span class="n">drawer</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewGroup</span><span class="o">)</span> <span class="n">drawerLayout</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">drawerLayout</span><span class="o">.</span><span class="na">setFitsSystemWindows</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
            <span class="n">contentLayout</span><span class="o">.</span><span class="na">setFitsSystemWindows</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
            <span class="n">contentLayout</span><span class="o">.</span><span class="na">setClipToPadding</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">drawer</span><span class="o">.</span><span class="na">setFitsSystemWindows</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>需要注意的是，<code class="highlighter-rouge">DrawerLayout</code> 的布局只能包含两个直接子布局，一个是内容布局，一个是抽屉布局，结构如前面的示例布局所示，如果内容布局的根布局如果不是 <code class="highlighter-rouge">LinearLayout</code> 需要对其子布局设置<code class="highlighter-rouge">padding top</code>值，否则仿状态栏色块会被遮挡在最下面，布局内容延伸到状态栏，如下图所示：</p>

<p><img src="http://ac-qygvx1cc.clouddn.com/49f7e6a7bd524179.png" alt="" /></p>

<p>（ps：就上图中的问题，目前的解决方案感觉并不是很好，如果你有更好的解决方案，请告诉我~）</p>

<ul>
  <li>DrawerLayout 状态栏透明</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 为 DrawerLayout 布局设置状态栏透明
     *
     * @param activity     需要设置的activity
     * @param drawerLayout DrawerLayout
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">setTranslucentForDrawerLayout</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">,</span> <span class="n">DrawerLayout</span> <span class="n">drawerLayout</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">KITKAT</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 设置状态栏透明</span>
            <span class="n">activity</span><span class="o">.</span><span class="na">getWindow</span><span class="o">().</span><span class="na">addFlags</span><span class="o">(</span><span class="n">WindowManager</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">FLAG_TRANSLUCENT_STATUS</span><span class="o">);</span>
            <span class="c1">// 设置内容布局属性</span>
            <span class="n">ViewGroup</span> <span class="n">contentLayout</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewGroup</span><span class="o">)</span> <span class="n">drawerLayout</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="n">contentLayout</span><span class="o">.</span><span class="na">setFitsSystemWindows</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">contentLayout</span><span class="o">.</span><span class="na">setClipToPadding</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="c1">// 设置抽屉布局属性</span>
            <span class="n">ViewGroup</span> <span class="n">vg</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewGroup</span><span class="o">)</span> <span class="n">drawerLayout</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">vg</span><span class="o">.</span><span class="na">setFitsSystemWindows</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
            <span class="c1">// 设置 DrawerLayout 属性</span>
            <span class="n">drawerLayout</span><span class="o">.</span><span class="na">setFitsSystemWindows</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>同样的，在 <code class="highlighter-rouge">setContentView()</code> 之后调用上述解决方案中的方法即可。</p>

<h3 id="section-5">在项目中使用</h3>

<p>以上代码我整理成了一个工具类，放在 github 上：<a href="https://github.com/laobie/StatusBarDemo/blob/master/app/src/main/java/com/jaeger/statusbardemo/StatusBarUtils.java">StatusBarUtils.java 文件</a></p>

<p>在项目中推荐这样使用，在 <code class="highlighter-rouge">BaseActivity</code> 中重写 <code class="highlighter-rouge">setContentView(int layoutResID)</code> 方法，新建一个 <code class="highlighter-rouge">setStatusBar()</code>方法，全局设置状态栏颜色，因为一般 App 大部分界面状态栏都是主题色。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BaseActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">setContentView</span><span class="o">(</span><span class="kt">int</span> <span class="n">layoutResID</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">setContentView</span><span class="o">(</span><span class="n">layoutResID</span><span class="o">);</span>
        <span class="n">setStatusBar</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">setStatusBar</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">StatusBarUtils</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorPrimary</span><span class="o">));</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>当子类 Activity 的状态栏需要特殊处理时，比如设置不同的颜色，或者设置图片为背景时，重写父类的 <code class="highlighter-rouge">setStatusBarColor()</code> 方法即可，例如：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImageStatusBarActivity</span> <span class="kd">extends</span> <span class="n">BaseActivity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_image_status_bar</span><span class="o">);</span>
        
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">setStatusBar</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">StatusBarUtils</span><span class="o">.</span><span class="na">setTranslucent</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>对 DrawerLayout 布局使用时，需要注意一点，因为方法是在 <code class="highlighter-rouge">setContentView()</code> 之后立即调用的，所以传进来的 <code class="highlighter-rouge">DrawerLayout</code> 要通过 <code class="highlighter-rouge">findViewById()</code> 传进来。如果传入在 <code class="highlighter-rouge">setContentView()</code> 之后通过 <code class="highlighter-rouge">findViewById()</code> 得到的 <code class="highlighter-rouge">DrawerLayout</code>， 则会造成空指针异常。</p>

<div class="highlighter-rouge"><pre class="highlight"><code> <span class="n">StatusBarUtils</span><span class="o">.</span><span class="na">setColorForDrawerLayout</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="o">(</span><span class="n">DrawerLayout</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">drawer_layout</span><span class="o">),</span> <span class="n">getResources</span><span class="o">()</span>
                <span class="o">.</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorPrimary</span><span class="o">));</span>
</code></pre>
</div>

<h3 id="demo">源码和Demo下载</h3>

<p><a href="https://github.com/laobie/StatusBarDemo">StatusBarDemo Github 地址</a></p>

<p><a href="https://github.com/laobie/StatusBarDemo/blob/master/app/src/main/java/com/jaeger/statusbardemo/StatusBarUtils.java">StatusBarUtils.java 文件</a></p>

<p><a href="http://fir.im/5mnp">Demo apk 下载</a></p>

<p>效果在前文中都有截图，就不多放了。</p>

<p>如文章中有疏漏的地方，请联系我或在评论里告知。</p>


        
        
        
        <!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key=/android/2016/02/15/status-bar-demo data-title=Android App 沉浸式状态栏解决方案 data-url="laobie.github.io/android/2016/02/15/status-bar-demo.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"jaeger"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->

     <script type="text/javascript">
     var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1256704919'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1256704919%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</content>





</div>
</div>
</div>
</div>
